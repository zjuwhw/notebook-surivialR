[["index.html", "Preface", " Preface This is a notebook for reading the book “Applied Survival Analysis using R” "],["introduction.html", "1 Introduction 1.1 What is Survival Analysis 1.2 What you need to know to use this book 1.3 Survival Data and Censoring 1.4 Some examples of survival data sets", " 1 Introduction 1.1 What is Survival Analysis Survival analysis, survival times, factors influencing survival times 1.2 What you need to know to use this book 1.3 Survival Data and Censoring response variable, time-to-event, is a non-negative discrete or continuous random variable censoring, right censoring, results when the final endpoint is only known to exceed a particular value \\(T^*\\) is a random variable representing the time to failure U is a random variable representing the time to a censoring event what we observe is \\(T=min(T^*,U)\\) and a censoring indicator \\(\\delta=I[T^*&lt;U]\\). \\(\\delta\\) is 0 when T is a censored time, or 1 when T is observed. right-censoring, left-censoring (less common) Three types: - Type I, the censoring times are pre-specified - Type II, follow-up stops when a pre-specified fraction have failed - Random. Patient dropout. Competing events. Administrative censoring. Example 1.1. clinial trail; accural period + follow-up period administrative censoring; patient dropout: non-informative (unrelated) vs informative (related to the failure process) The goals of surivival analysis estimate the survival distribution compare two or more survival distributions assess the effects of a number of factors on survival 1.4 Some examples of survival data sets Example 1.2. Xelox (chemotherapy drug) in patients with advanced gastric (胃) cancer Progression-free survival: the time from entry into the clinical trial until progression or death, whichever comes first Wang et al. Cancer Chemother. Pharmacol 2014 #install.packages(&quot;asaur&quot;) library(asaur) gastricXelox[23:27,] ## timeWeeks delta ## 23 42 1 ## 24 43 1 ## 25 43 0 ## 26 46 1 ## 27 48 0 Example 1.3 Pancreatic cancer (胰腺癌) in patients with locally advanced or metastatic disease Moss et al., Gastrointest. Cancer Res. 2012 head(pancreatic) ## stage onstudy progression death ## 1 M 12/16/2005 2/2/2006 10/19/2006 ## 2 M 1/6/2006 2/26/2006 4/19/2006 ## 3 LA 2/3/2006 8/2/2006 1/19/2007 ## 4 M 3/30/2006 . 5/11/2006 ## 5 LA 4/27/2006 3/11/2007 5/29/2007 ## 6 M 5/7/2006 6/25/2006 10/11/2006 ### stage column: M means metastatic; LA means locally advanced Example 1.4 survival prospects of prostate cancer patients (前列腺癌) with high-risk disease Lu-Yao et al., J. Am. Med. Assoc, 2009 prostateSurvival[88:95,] ## grade stage ageGroup survTime status ## 88 poor T2 75-79 33 0 ## 89 mode T2 75-79 6 0 ## 90 mode T1c 75-79 15 2 ## 91 mode T2 70-74 6 2 ## 92 mode T1ab 80+ 93 1 ## 93 poor T2 80+ 60 2 ## 94 mode T2 80+ 1 0 ## 95 mode T1ab 75-79 34 0 ### grade: poorly or moderately differentiated ### cancer stage: T1c if screen-diagnosed using a prostate-specific antigen blood test, T1ab if clinically diagnosed without screening, or T2 if palpable at diagnosis ### surival time: days from diagnosis to death or date last seen ### status: 1 if died of prostate cancer, 2 if died of some other cause, or 0 still alive at the date last seen Example 1.5 Comparison of medical therapies to aid smokers to quit triple-mdication combination vs therapy with the nicotine patch alone time from randomization until relapse (return to smoking); censored at six months Steinberg Ann. Intern. Med 2009 pharmacoSmoking[1:6, 2:8] ## ttr relapse grp age gender race employment ## 1 182 0 patchOnly 36 Male white ft ## 2 14 1 patchOnly 41 Male white other ## 3 5 1 combination 25 Female white other ## 4 16 1 combination 54 Male white ft ## 5 0 1 combination 45 Male white other ## 6 182 0 combination 43 Male hispanic ft # ttr: time to relapse/the number of days without smoking # employment: ft (full time), pt (part time), or other Example 1.6 Prediction of survival of hepatocellular carcinoma (肝细胞癌) patients using biomarkers hepatoCellular[c(1,2,3,65,71),c(2,3,16:20,24,47)] ## Age Gender OS Death RFS Recurrence CXCL17T CD4N Ki67 ## 1 57 0 83 0 13 1 113.94724 0 6.04350 ## 2 58 1 81 0 81 0 54.07154 NA NA ## 3 65 1 79 0 79 0 22.18883 NA NA ## 65 38 1 5 1 5 1 106.78169 0 44.24411 ## 71 57 1 11 1 11 1 98.49680 0 99.59232 # OS: overall survival # RFS: recurrence-free survival "],["basic-principles-of-survival-analysis.html", "2 Basic Principles of Survival Analysis 2.1 Hazard and Survival Functions 2.2 Other Representations of a Survival Distribution 2.3 Mean and Median Survival Time 2.4 Parametric Survival Distributions 2.5 Computing the Survival Function from the Hazard Function", " 2 Basic Principles of Survival Analysis 2.1 Hazard and Survival Functions Survival function defines the probability of surviving up to a point t, \\[S(t)=pr(T&gt;t), 0&lt;t&lt;\\infty\\] , which decreases (or remains constant) over time Hazard function is the instantaneous (瞬间) failure rate, \\[h(t) = \\lim\\limits_{\\delta \\to \\infty}\\frac{pr(t&lt;T&lt;t+\\delta|T&gt;t)}{\\delta}\\] This function is also known as intensity function or the force of mortality Example 2.1 The daily hazard rates of men and women by age in each calendar year from 1940 to 2004 library(survival) tm &lt;- c(0, 1/365, # first day of life 7/365, # seventh day of life 28/365, # fourth week of life 1:110) # subsequent years hazMale &lt;- survexp.us[,&quot;male&quot;,&quot;2004&quot;] hazFemale &lt;- survexp.us[,&quot;female&quot;,&quot;2004&quot;] ## not sure how to get the harzard for the days or weeks in the first year plot(1:110, log10(hazMale), col=&quot;blue&quot;, type=&quot;l&quot;, ylab=&quot;log10(hazard)&quot;, xlab=&quot;age in years&quot;) lines(1:110, log10(hazFemale), col=&quot;red&quot;) legend(0, -2.7, legend=c(&quot;male&quot;, &quot;female&quot;), lty=1, col=c(&quot;blue&quot;, &quot;red&quot;)) 2.2 Other Representations of a Survival Distribution Cumulative distribution function (CDF), also known as the cumulative risk function \\[F(t) = pr(T \\le t) = 1-S(t), 0&lt;t&lt;\\infty\\] Probability density function (PDF), \\[f(t) = \\frac{d}{dt} F(t) = \\frac{d}{dt}[1-S(t)]=-\\frac{d}{dt}S(t)\\] , related to hazard function and survival functions \\[h(t)=\\frac{f(t)}{S(t)}\\] That is, the harzard at time t is the probability that an event occurs in the neighborhood of time t divided by the probability that the subject is alive at time t. The cumulative hazard function is defined as the area under the hazard function up to time t, \\[H(t)=\\int_0^th(u)du\\] The survival function may be defined in terms of the harzard function by \\[S(t)=exp(-\\int_0^th(u)du)=exp(-H(t))\\] Derivations: \\(H(t) = \\int_0^th(u)du\\) \\(=\\int_0^t\\frac{f(u)}{S(u)}du\\) \\(=\\int_0^t\\frac{-\\frac{d}{du}S(u)}{S(u)}du\\) \\(=\\int_0^t\\frac{-d(S(u))}{S(u)}\\) \\(=-ln(S(u))|^t_0\\) \\(=-ln(S(t))+ln(S(0))\\) \\(=-ln(S(t))\\) 2.3 Mean and Median Survival Time \\[\\mu=E(T)=\\int_0^\\infty tf(t)dt\\] Based on \\(\\lim\\limits_{t \\to \\infty}(tS(t))=0\\), we can have a formula \\[\\mu=\\int_0^\\infty S(t)dt\\] The mean survival time is only defined if \\(S(\\infty)=0\\) (such as time to death), but not in the case \\(S(\\infty)=c\\) (such as cancer recurrence; fraction c of subjects will not recurrent, and the area under the survival curve is infinite) The median survival time is defined as the time t such that \\(S(t)=1/2\\). 2.4 Parametric Survival Distributions The exponential distribution, the simplest survival distribution, has a constant hazard, \\(h(t)=\\lambda\\) The cumulative hazard function \\[H(t)=\\int_0^t h(u)du=\\int_0^t \\lambda du=\\lambda t|_0^t=\\lambda t\\] The survival function is \\[S(t)=e^{-H(t)}=e^{-\\lambda t}\\] The probability density function is \\[f(t) = h(t)S(t)=\\lambda e^{-\\lambda t}\\] The mean of survival time is \\[E(T)=\\int_0^{\\infty} S(t)dt=\\int_0^{\\infty} e^{-\\lambda t}dt = 1/\\lambda\\] The median of survival time is \\[0.5=e^{-\\lambda t}\\text{, so }t_{med}=ln(2)/\\lambda\\] lambda=1/70 layout(matrix(1:4,2,2)) plot(1:100, rep(lambda,100), xlab=&quot;time&quot;, ylab=&quot;Hazard&quot;, ylim=c(0,2/70), type=&quot;l&quot;) plot(1:100, exp(-lambda*(1:100)), xlab=&quot;time&quot;, ylab=&quot;Survival&quot;, type=&quot;l&quot;) plot(1:100, lambda*(1:100), xlab=&quot;time&quot;, ylab=&quot;Cumulative hazard&quot;, type=&quot;l&quot;) plot(1:100, lambda*exp(-lambda*(1:100)), xlab=&quot;time&quot;, ylab=&quot;PDF&quot;, type=&quot;l&quot;) Another distibution is Weibull distribution. Its hazard function \\[h(t)=\\alpha\\lambda(\\lambda t)^{\\alpha-1}=\\alpha\\lambda^{\\alpha}t^{\\alpha-1}\\] The cumulative hazard \\[H(t)=(\\lambda t)^{\\alpha}\\] The survival function \\[S(t) = e^{-(\\lambda t)^{\\alpha}}\\] The mean of survival time \\[E(T)=\\frac{\\Gamma(1+1/\\alpha)}{\\lambda}\\] , where \\(\\Gamma(x)=(x-1)!\\) is gamma function The median of survival time \\[t_{med}=\\frac{[ln(2)]^{1/\\alpha}}{\\lambda}\\] The exponential distribution is a special case with \\(\\alpha=1\\) h = function(t, alpha, lambda){ return(alpha*(lambda^alpha)*(t^(alpha-1))) } lambda=0.03 plot(1:80, h(1:80, alpha=1, lambda), xlab=&quot;time&quot;, ylab=&quot;hazard&quot;, type=&quot;l&quot;, ylim=c(0,0.08)) lines(1:80, h(1:80, alpha=1.5, lambda), col=&quot;red&quot;) lines(1:80, h(1:80, alpha=0.75, lambda), col=&quot;blue&quot;) text(40, 0.035, &quot;alpha=1, lambda=0.03&quot;) text(40, 0.06, &quot;alpha=1.5, lambda=0.03&quot;, col=&quot;red&quot;) text(40, 0.01, &quot;alpha=0.75, lambda=0.03&quot;, col=&quot;blue&quot;) ### Weibull distribution can be calculated dweilbull() or pweibull() h2 = function(t, alpha, lambda){ return(dweibull(t, shape=alpha, scale=1/lambda)/pweibull(t, shape=alpha, scale=1/lambda, lower.tail=F)) } plot(1:80, h2(1:80, alpha=1, lambda), xlab=&quot;time&quot;, ylab=&quot;hazard&quot;, type=&quot;l&quot;, ylim=c(0,0.08), main=&quot;using dweibull and pweibull function&quot;) lines(1:80, h2(1:80, alpha=1.5, lambda), col=&quot;red&quot;) lines(1:80, h2(1:80, alpha=0.75, lambda), col=&quot;blue&quot;) text(40, 0.035, &quot;alpha=1, lambda=0.03&quot;) text(40, 0.06, &quot;alpha=1.5, lambda=0.03&quot;, col=&quot;red&quot;) text(40, 0.01, &quot;alpha=0.75, lambda=0.03&quot;, col=&quot;blue&quot;) ### generate random variables set.seed(1) tt.weib = rweibull(1000, shape=1.5, scale=1/0.03) mean(tt.weib); median(tt.weib) ## [1] 29.90708 ## [1] 26.95561 ### the theoretical mean and median gamma(1+1/1.5)/0.03 ## [1] 30.09151 (log(2)^(1/1.5))/0.03 ## [1] 26.10733 A third distribution can be gamma distribution, with the PDF \\[f(t)=\\frac{\\lambda^\\beta t^{\\beta-1}exp[-\\lambda t]}{\\Gamma(\\beta)}\\] Its hazard function cannot be written in closed form, but can be computed using R gammaHaz = function(t, shape, scale){ return(dgamma(t, shape=shape, scale=scale)/pgamma(t, shape=shape, scale=scale, lower.tail=F)) } There are other parametric families of survival distributions, including log-normal, log-logistic, Pareto, and many more. 2.5 Computing the Survival Function from the Hazard Function For complicated hazard function, we can use numerical methods to evaluate the integral. ### back to the Example 2.1 library(survival) tm = 0:110 hazMale = survexp.us[,&quot;male&quot;, &quot;2004&quot;] hazFemale = survexp.us[,&quot;female&quot;, &quot;2004&quot;] tm.diff = diff(tm) ## time intervals ## survival survMale = exp(-cumsum(hazMale*tm.diff)*365.24) survFemale = exp(-cumsum(hazFemale*tm.diff)*365.24) plot(1:110, survMale, col=&quot;blue&quot;, type=&quot;l&quot;, ylab=&quot;Survival&quot;, xlab=&quot;age in years&quot;) lines(1:110, survFemale, col=&quot;red&quot;) legend(0, 0.2, legend=c(&quot;male&quot;, &quot;female&quot;), lty=1, col=c(&quot;blue&quot;, &quot;red&quot;)) sum(survMale*tm.diff) ## [1] 74.38014 sum(survFemale*tm.diff) ## [1] 79.44648 "]]
